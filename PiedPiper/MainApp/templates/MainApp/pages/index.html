{% extends 'MainApp/base.html' %}

{% block content %}
    <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <form action="/" method="post" class="form-inline">
            {% csrf_token %}
            {{ form }}
            <input type="submit" value="Search" class="btn btn-primary"/>
        </form>

        {% if url %}
            <br>
            <br>

            <div id='loadingMessage' style='display:none'>
                <img src='https://d368g9lw5ileu7.cloudfront.net/img/rsuWaitingLarge.bwo7Y7.gif'/><br>
                <img src='https://4.bp.blogspot.com/-m-M0doCYTeE/V_CgCGtKXII/AAAAAAAACCY/phrSWiKZ7VIQRNB-_uqRq2pCfkA4FGC7QCLcB/s640/progressbar2.gif'/>
            </div>

            <table id="datatable" class="display" width="100%" cellspacing="0">
                <thead></thead>
                <tbody></tbody>
                <tfoot></tfoot>
            </table>

            {% include 'MainApp/pages/save_modal.html' %}
        {% endif %}
    </div>
{% endblock %}


{% if url %}
    {% block script %}
        <script>
            $(document).ready(function () {

                var url = '{{ url }}';
                $('#loadingMessage').show();
                $.ajax({
                    url: url,
                    dataType: 'json',
                    success: function (jsonData) {
                        $('#datatable').dataTable({
                            data: jsonData,
                            columns: [
                                {
                                    title: 'Track ID',
                                    data: 'trackId',
                                    defaultContent: 'Null'
                                },
                                {
                                    title: 'Artist Name',
                                    data: 'artistName',
                                    defaultContent: 'Null'
                                },
                                {
                                    title: 'Track Name',
                                    data: 'trackName',
                                    defaultContent: 'Null'
                                },
                                {
                                    title: 'Release Date',
                                    data: 'releaseDate',
                                    defaultContent: 'Null'
                                }
                            ]
                        });
                        $('#loadingMessage').hide();
                        $('#myButton').show();

                    }
                });

                $('#datatable').on('mouseover', 'tbody tr', function () {
                    $(this).css({
                        'cursor': 'pointer',
                        'color': 'blue'
                    });
                })

                $('#datatable').on('mouseout', 'tbody tr', function () {
                    $(this).css({
                        'cursor': 'default',
                        'color': 'inherit'
                    });
                })

                $('#datatable').on('click', 'tbody tr', function () {
                    var url = window.location.href;
                    url += 'details/' + $(this).children(':first').text();
                    window.location.assign(url);
                });


            });

            $('#yesButton').click(function (e) {
                e.preventDefault(); // prevent form from reloading page


                $.ajax({
                    'url': '/save/{{ term }}',
                    'type': 'GET',
                    beforeSend: function () {
                        $('.theContent').hide();
                        $('.uploadingMessage').show();
                    },
                    error: function () {
                        alert('Error');
                    },
                    'success': function (data) {
                        $('.uploadingMessage').hide();
                        $('.savedMessage').show();
                    }
                });
            });
        </script>
    {% endblock %}

{% endif %}